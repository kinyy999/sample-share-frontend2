# 📘 progress_log.md — SampleShare

## 📅 13--16/07/2025 — שבוע ראשון(חלק ) : הקמת בסיס למערכת SampleShare

### ⏱ משך עבודה משוער 9  שעות

---

### ✅ מה הושלם בפועל

#### 🎯 התחלה רשמית של פרויקט SampleShare  
- פתיחה של פרויקט גמר אישי בתחום מערכות שיתוף קבצים, בשם: **SampleShare**.  
- הבנת הכיוון הכללי: מערכת Full Stack לשיתוף סאמפלים מוזיקליים.  
- מטרה: לאפשר למשתמשים להעלות, לעיין, להגיב ולנהל דגימות סאונד.

#### 🧱 עבודת הכנה על מבנה הקוד
- פתיחה של קבצי קוד רלוונטיים והבנה של הקבצים הקיימים בפרויקט.
- עיון בקבצים `server.js` ו-`sample.js` ובירור מה תפקידם בתוך המערכת.
- זיהוי שאין קובץ `routes/` נפרד, ולכן הנתבים (routes) מתבצעים מתוך `server.js`.
- התחלה של בניית לוגיקת תגובות (`comments`) הקשורות ל־samples.

#### 🧪 ניסיונות בדיקה והרצה
- הרצת שרת Express באמצעות `npm start` או `node server.js`.
- ביצוע שינויים בקוד והבנה שהתגובות לא נשמרות או לא מתעדכנות נכון.
- בדיקת זרימת נתונים: האם sample אכן מחובר לתגובה (comment)?
- שימוש ב־VS Code לביצוע שינויים ישירים בקוד — תוך שמירה על מבנה מסודר.

---

### 🛠 אתגרים ומה שניסינו לפתור

#### ❗ איתור תקלות וחוסר התאמה
- הקוד לא פעל לפי הציפייה: התגובה שנשלחה לא נשמרה או לא הופיעה בעדכון.
- חוסר בתיקייה `routes/` גרם לבלבול – אך הובן שזה לא קריטי אם הנתיבים מוגדרים ישירות ב־`server.js`.

#### 🧠 ניסיונות פתרון
- ניסיון לבדוק אם יש בעיה במודל התגובה או בקשר שלה ל־sample.
- בדיקת ה־controller או המסלול שמנהל את שליחת התגובה.
- ניסיונות לבדוק ולשפר את החיבור בין התגובה למסד הנתונים.

---

### 📌 תכנון להמשך

#### ➕ פעולות מתוכננות
- לבנות תשתית מלאה ל־sample כולל:
  - יצירה (POST)
  - שליפה (GET)
  - מחיקה (DELETE)
  - עדכון (PUT / PATCH)
- יצירת מודל תגובה ברור ומחובר.
- התחלת חיבור לפרונטאנד בעתיד (React או Next.js).
- הכנת מערכת הרשאות למשתמשים (JWT).

#### 🗂 תשתית קבצים עתידית
- להוסיף תיקיית `routes/` ולהתחיל לפצל את הקוד בהתאם.
- יצירת קבצי `controllers/` לכל פעולה: שליפה, הוספה, עדכון, מחיקה.
- יצירת תיקיית `middleware/` עבור אימותים, טוקנים, הרשאות וכו'.

---

### 📝 סיכום שבועי

השבוע הראשון היה מוקדש בעיקר להבנת המבנה הקיים, התחלת כתיבת לוגיקה בסיסית, הרצת קוד והתחלה של דיבאגינג. התשתית עוד לא הייתה מלאה, אך הונח בסיס חשוב שיאפשר המשך מסודר ויציב בימים הבאים. כבר נבחנו נקודות קריטיות כמו: מיקום קוד, חיבור למסד נתונים, לוגיקת שליחה ותגובה, וניהול זרימת מידע בין sample ל־comments.



## 📅 17--20/07/2025 — שבוע ראשון(חלק ): התקנות מערכת, התחלת backend עם הרשאות


### ⏱ משך עבודה משוער
11 שעות

---

### ✅ מה הושלם בפועל

#### ⚙️ התקנת סביבת פיתוח מקומית
- התקנת Node.js ו-npm על macOS
- התקנת MongoDB מקומי והפעלה כ־service עם Homebrew
- בדיקת חיבור למסד נתונים עם Compass
- התקנת Postman לצורך בדיקות API
- הגדרת סביבת עבודה עם VS Code:
  - פתיחת התיקייה הראשית של SampleShare
  - יצירת קבצי `server.js`, `models/`, `routes/`
  - הגדרת `package.json` עם סקריפטים להרצה (`start`, `dev`)
  - התקנת ספריות חשובות: `express`, `mongoose`, `cors`, `dotenv`, `bcryptjs`, `jsonwebtoken`, `nodemon`

#### 🏗 התחלת פיתוח backend — שלב 1
- הגדרת שרת Express בסיסי ב־`server.js`
- חיבור למסד נתונים MongoDB דרך Mongoose
- יצירת תיקיית `models/` עם מודל `User.js`
- הוספת הצפנת סיסמאות עם `bcryptjs`
- יצירת מסלולים:
  - `POST /api/register` — רישום משתמש חדש
  - `POST /api/login` — התחברות וקבלת JWT
- יצירת token עם `jsonwebtoken` ושמירתו ב-localStorage בפרונטאנד בעתיד
- יצירת קובץ `.env` לניהול משתנים סודיים:
  - MONGO_URI
  - JWT_SECRET
  - PORT

---

### 🛠 אתגרים ומה שניסינו לפתור

#### 🔐 בעיות עם הרשאות והצפנת סיסמאות
- פתרון בעיות עם הצפנת סיסמה שלא נשמרה כראוי במסד הנתונים
- טיפול במקרה בו משתמשים לא מקבלים טוקן עקב טעות בקוד JWT
- הוספת טיפול בשגיאות למקרי login לא תקין

#### 🧪 בדיקות API עם Postman
- בדיקות POST מלאות עם payload עבור רישום והתחברות
- בדיקה שהסיסמאות נשמרות מוצפנות במסד נתונים
- בדיקה שהטוקן אכן נשלח חזרה ללקוח

---

### 📌 תכנון להמשך

#### 🎯 פעולות מתוכננות לפעם הבא
- יצירת middleware `authenticateToken` להגנה על מסלולים
- יצירת מודל Sample עם תכונות (title, genre, bpm, url וכו’)
- בניית מסלולים מוגנים ל־`GET /samples`, `POST /samples`, `DELETE /samples/:id`
- בדיקת מסלולים מאובטחים דרך Postman עם Authorization: Bearer token
- התחלת דחיפה של קוד ל־GitHub
- כתיבת README בסיסי ויומן התקדמות

---

### 📝 סיכום שבועיי

ביום זה הוקם ה-backend הראשוני של SampleShare, כולל התחברות למסד נתונים, יצירת מודלים למשתמשים, הצפנת סיסמאות והפקת טוקנים עם JWT. כמו כן, התבצעה התקנה והכנה של סביבת העבודה המקומית, כולל בדיקות חכמות באמצעות Postman. זה היה שלב מכריע שבו הונחה תשתית האבטחה והאותנטיקציה לפרויקט כולו.





## 📅 21---23/07/2025 — שבוע שני(חלק ): מסלולים מאובטחים, שליפת דגימות, middleware, בדיקות

### ⏱ משך עבודה משוער
כ־–13 שעות

---

### ✅ מה הושלם בפועל

#### 🧱 המשך בניית backend — שלב 2
- יצירת middleware בשם `authenticateToken`:
  - בודק את הטוקן המועבר ב־Authorization header
  - מאפשר גישה רק למשתמשים עם טוקן תקין
- שילוב של המידלוור הזה במסלולים המוגנים

#### 🎵 התחלת עבודה על מודל Sample
- יצירת מודל `Sample.js` עם שדות:
  - title, bpm, key, genre, url, tags, description, isPublic, owner, createdAt
- קישור בין Sample לבין משתמש (owner)

#### 🌐 יצירת מסלולים חדשים בשרת:
- `GET /samples` — שליפת כל הדגימות לצפייה (נגיש רק עם טוקן)
- `POST /samples` — יצירת sample חדש על ידי משתמש מחובר
- `DELETE /samples/:id` — מחיקת sample לפי מזהה (מותנה בהרשאות)

#### 🧪 בדיקות עם Postman
- בדיקות של שליחה, שליפה ומחיקה של דגימות:
  - בדיקה ש־GET לא עובד ללא טוקן
  - בדיקה ש־POST מצליח רק עם טוקן תקף
  - מחיקת sample קיימת רק עם טוקן מתאים
- בדיקה שהמערכת שומרת את שם המשתמש המחובר תחת sample.owner

---

### 🛠 אתגרים ומה שניסינו לפתור

#### ❗ בעיות בקריאה ללא טוקן
- טופל באמצעות middleware שחוסם גישה ודוחף שגיאה ברורה (`403 - Token Required`)
- נוספה הודעה שמופיעה כאשר המשתמש לא מחובר

#### ❌ בעיות בהבנת סוגי בקשות
- טופל בלוגיקה בין GET ו-POST במסלולים השונים
- ווידוא שכל פעולה אכן מתבצעת בהתאם לסוג הבקשה

#### 🧾 סדר בפרויקט
- פיצול הלוגיקה לפי קבצים: routes, models, middleware
- שמירה על קוד נקי עם שגיאות מטופלות בקונסול

---

### 📌 תכנון להמשך

#### 🔜 פעולות מתוכננות להמשך
- יצירת UI ראשוני לפרונטאנד עם Next.js (או React)
- בניית דף הצגת samples + אפשרות תגובה
- חיבור פרונטאנד ל־API
- התחלת עבודה על הרשאות admin

---

### 📝 סיכום שבוע

ביום הזה הורחבה מערכת ה־backend של SampleShare עם יצירת מודל הדגימות, מסלולים מלאים לשליפה, הוספה ומחיקה של samples. נוספה אבטחה עם middleware שמבצע אימות על בסיס JWT ומאפשר גישה רק למשתמשים מורשים. כל הפעולות נבדקו עם Postman, ונבנתה תשתית לוגית חזקה להמשך חיבור צד הלקוח.


## 📅 23---27/07/2025 — שבוע שני(חלק ): תיקונים, רענון פרויקט, הכנה ל־ Frontend

### ⏱ משך עבודה משוער
כ־8 שעות

---

### ✅ מה הושלם בפועל

#### 🧼 רענון וניקוי
- סידור קבצי backend לקראת חיבור ל־frontend:
  - ווידוא שכל הפונקציות במסלולים (`routes/samples.js`, `routes/auth.js`) עובדות
  - מחיקת סאמפלים ישנים ממסד הנתונים לניקוי בסיס
- ווידוא שמודל `Sample` כולל `owner` חובה, למניעת בעיות של אנונימיות בבעלות

#### 🔁 בדיקות מסלולים שוב
- בדיקות חוזרות עם Postman:
  - `GET /samples` — עובד עם טוקן בלבד
  - `POST /samples` — דגימה נשמרת כראוי, כולל owner
  - `DELETE /samples/:id` — מוחק רק עם טוקן, מופיע קונסול תקין
- בדיקת טיפול בשגיאות במקרה של חוסר טוקן או token פגום

#### 🔒 התחלה של הגדרות משתמשים והרשאות
- מחשבה על הרחבת ה־middleware בהמשך כדי לתמוך ב־admin
- שמירה על מודול `authenticateToken` מוכן להרחבות עתידיות

---

### 🛠 אתגרים ומה שניסינו לפתור

#### 🔃 בעיות בבדיקה של דגימות ישנות
- דגימות שהוזנו ידנית לפני שנשמר שדה `owner` גרמו לקריסת התצוגה
- פתרון: מחיקה של הדגימות הבעייתיות ובדיקה שחדשות פועלות תקין

#### ❓ בלבול לגבי חיבור העתידי ל־frontend
- התקבלה ההחלטה להמתין עם הפרונטאנד עד שה־API יציב

---

### 📌 תכנון להמשך

#### 🔜 פעולות לפעם הבא 
- התחלת עבודה על הפרונטאנד עם Next.js (מבוסס React)
- בניית ממשק משתמש להצגת samples
- חיבור קריאות GET ו־POST מהפרונטאנד לשרת
- התחלת בניית קומפוננטה של טופס sample חדש

---

### 📝 סיכום שבועי

היום הוקדש לניקוי בסיסי של המערכת והכנת הקרקע לצד לקוח (frontend). המסלולים נוסו שוב, הטוקנים טופלו היטב, ודגימות שנוצרו ללא בעלים נמחקו לצורך יציבות. תשתית השרת מוכנה ומסודרת, וניתן לעבור לשלב התצוגה והאינטראקציה.

## 📅 28/07--2/8/2025 — שבוע שלישי(חלק ): שיפור אבטחה, בדיקות DELETE, עדכון middleware

### ⏱ משך עבודה משוער
כ־16 שעות

---

### ✅ מה הושלם בפועל

#### 🔐 חיזוק ההגנה במסלולים
- שיפור מסלול `DELETE /samples/:id` כך שרק משתמשים מחוברים יכולים למחוק
- ווידוא שפעולת המחיקה כוללת בדיקת טוקן תקף דרך `authenticateToken`
- תכנון עתידי: רק משתמש שהוא ה־owner או admin יוכל למחוק

#### 🧪 בדיקות אינטנסיביות עם Postman
- בדיקת DELETE עם טוקן: הצלחה ✅
- בדיקת DELETE ללא טוקן: חסימה עם שגיאה ❌
- שליחה של טוקן שגוי: קיבלה שגיאה צפויה
- בדיקות חוזרות גם ל־`GET` ו־`POST` עם טוקן ובלעדיו — ווידוא שעובדים תקין

#### 🧹 סדר בפרויקט + ניהול הרשאות
- הכנה לקראת הרשאות מבוססות תפקידים (`role`)
- התחלת שיחה על מבנה תפקידים (user, admin וכו׳)
- התחלה של פיצול הפונקציות לפי controller

---

### 🛠 אתגרים ומה שניסינו לפתור

#### ❌ משתמש לא מחובר הצליח לשלוח בקשת DELETE
- נוסף `authenticateToken` ישירות על המסלול הרלוונטי
- הופיעה שגיאה אם לא הועבר header Authorization

#### ⚠️ בעיה: כפתור מחיקה נשאר לחיץ גם כשאין טוקן (בפרונטאנד)
- תועד לטיפול בעתיד — לשמור על UX טוב: "Deleting..." במצב disabled
- נרשמה תזכורת קבועה: להוסיף בהמשך כפתור שננעל בזמן מחיקה

---

### 📌 תכנון להמשך

#### 🔜 פעולות מתוכננות
- הוספת תפקידים (`role`) למשתמשים: רגיל / אדמין
- הוספת בדיקה במסלול DELETE האם המשתמש הוא הבעלים של הדגימה
- חיבור ראשוני לפרונטאנד — הבאת הדגימות ל־UI
- התחלת קובץ README רשמי

---

### 📝 סיכום השבוע

ביום הזה הוקדשה העבודה להקשחת האבטחה של המערכת, במיוחד סביב פעולת המחיקה. נוסף אימות JWT חזק, עם תגובות מדויקות למשתמשים לא מורשים. כל הבדיקות עברו בצורה חלקה דרך Postman, ונעשו הכנות לתמיכה ברמות הרשאות שונות בהמשך. כמו כן, הוחלט להתחיל לתעד כל פעולה בקובץ התקדמות מסודר.


## 📅 03--06/08/2025 — שבוע רביעי(חלק ): חיבור בין login ל־samples, התחלת עבודה על ה־Frontend

### ⏱ משך עבודה משוער
כ־13 שעות

---

### ✅ מה הושלם בפועל

#### 🚀 התחלת מעבר לפרונטאנד (Next.js)
- התחלת בניית צד לקוח עבור SampleShare בפרויקט Next.js
- פתיחת קובץ עמוד `pages/samples.tsx`
- בדיקת מעבר בין עמודים אחרי login

#### 🔗 חיבור ל־backend לאחר login
- שימוש ב־`useRouter` מ־Next.js לצורך ניווט לאחר התחברות:
  ```ts
  const router = useRouter();
  router.push("/samples");
  ```
- ווידוא שמעבר מתבצע רק אחרי התחברות תקינה
- טיפול בבעיות where router was undefined (פתרון ע"י `use client` בתחילת הקובץ)

---

### 🛠 אתגרים ומה שניסינו לפתור

#### 🔄 שימוש לא נכון ב־useRouter
- הקוד נכתב בתוך קובץ שלא הכיל `"use client"` ולכן קיבל שגיאה על `useRouter`
- נוספה ההוראה `use client` בראש הקובץ והבעיה נפתרה

#### ❗ בלבול בין login לבין דף דגימות
- ווידוא שהמשתמש מנותב לדף samples רק אחרי login תקין
- טיפול בשמירת הטוקן ב־localStorage כדי לאפשר גישה אחר כך למסלולים מאובטחים

---

### 📌 תכנון להמשך

#### 🔜 פעולות לפעם הבא 
- הצגת רשימת samples בפרונטאנד לפי קריאה ל־`GET /samples`
- הוספת יכולת תגובה והצגת תגובות לכל sample
- הוספת טיפול במקרה בו המשתמש לא מחובר: הצגת הודעה "You must login first"

---

### 📝 סיכום שבועי

ביום זה הונח הבסיס למעבר מהשרת לצד לקוח. התבצעה עבודה על ניווט בין עמודים לאחר login, שימוש ב־useRouter ו־localStorage לצורך התחברות ושמירת טוקן. אלו היו צעדים ראשונים חשובים ביצירת ממשק משתמש עבור פרויקט SampleShare.


## 📅 07--09/08/2025 — שבוע רביעי(חלק ) : UI של תגובות לדגימות, תצוגה מותנית, חיבור sample.comments

### ⏱ משך עבודה משוער
10 שעות

---

### ✅ מה הושלם בפועל

#### 💬 בניית ממשק תגובות (sample.comments)
- התחלה של תצוגת תגובות פר דגימה (`Sample`) בפרונטאנד
- שימוש ב־`sample.comments` לצורך מיפוי והצגה של תגובות בתוך `ul > li`
- כתיבת קוד JSX לתצוגת תגובות, כולל שם המשתמש, תאריך וטקסט התגובה:
```tsx
{sample?.comments && sample.comments.length > 0 ? (
  <ul className="space-y-2 mb-4">
    {sample.comments.map((c) => (
      <li key={c._id} className="rounded-md border border-gray-600 p-3">
        <div className="flex items-start justify-between">
          <div className="text-sm text-gray-700">
            <span className="font-medium">
              {c.user?.username || c.user?.email || "Unknown"}
            </span>
            {c.createdAt && (
              <span className="ml-2 text-gray-500">
                {new Date(c.createdAt).toLocaleString()}
              </span>
            )}
          </div>
          <div className="text-sm mt-1 text-gray-900">{c.text}</div>
        </div>
      </li>
    ))}
  </ul>
) : (
  <p className="text-gray-500">No comments yet</p>
)}
```

#### 🎨 עיצוב ראשוני של קופסאות תגובה
- שימוש ב־Tailwind CSS לעיצוב תגובות בגבול אפור, רקע לבן, פינות מעוגלות וריווח בין תגובות

---

### 🛠 אתגרים ומה שניסינו לפתור

#### ❌ תגובות לא הוצגו נכון
- בעיה: תגובות לא הופיעו כלל — טופלה ע"י תיקון בגישה ל־sample.comments
- ווידוא שכל תגובה מכילה `user`, `text`, `createdAt` לפני מיפוי

#### ⚠️ קריסת רכיב עקב תגובה חסרה
- מקרה שבו תגובה הייתה ללא user – טופל ע"י תנאי ברירת מחדל: "Unknown"

---

### 📌 תכנון להמשך

#### 🔜 פעולות למחר
- לאפשר שליחת תגובה חדשה לפר דגימה (POST /comments)
- לקשר בין תגובה למשתמש המחובר
- להציג תיבת טקסט + כפתור לשליחת תגובה
- לשפר UX אם אין תגובות בכלל (טקסט רך יותר)

---

### 📝 סיכום שבועי

יום זה התמקד בבניית ממשק ויזואלי להצגת תגובות הקשורות לדגימות מוזיקליות. תצוגה זו מחברת את צד המשתמש (UI) עם מבנה הדאטה שהוגדר ב־backend. בעיות של null/undefined בתגובות טופלו, והוצגו תגובות עם עיצוב מסודר תוך שימוש ב־Tailwind CSS. הונח בסיס טוב להוספת תגובות חדשות מחר.

## 📅 10--13/08/2025 — שבוע חמישי(חלק ): טיפול בקריסת המערכת עקב מחיקת דגימות, הוספת דרישת owner

### ⏱ משך עבודה משוער
7/8 

---

### ✅ מה הושלם בפועל

#### 🧨 פתרון תקלה חמורה במערכת
- כל הסאמפלים נמחקו בטעות ממסד הנתונים (MongoDB)
- פעולה זו גרמה לקריסת העמודים שמציגים דגימות ותגובות
- זוהה שהבעיה נובעת מכך ש־sample שנשמר ללא `owner` שובר את תצוגת הרכיב

#### 🛠 תיקון והקשחת מבנה המודל
- עדכון מודל `Sample.js` כך ששדה `owner` יוגדר כ־required
  ```ts
  owner: {
    type: mongoose.Schema.Types.ObjectId,
    ref: "User",
    required: true
  }
  ```
- ביצוע בדיקות להבטיח שכל sample חדש כולל `owner` תקף
- מחיקת כל רשומות ה־sample שהוזנו קודם ללא שדה `owner`

#### 🧪 בדיקות לאחר תיקון
- יצירת sample חדש דרך `POST /samples` כשהמשתמש מחובר
- ווידוא שב־sample החדש קיים `owner`
- בדיקה שהתצוגה בפרונטאנד חזרה לפעול כרגיל

---

### 🛠 אתגרים ומה שניסינו לפתור

#### ⚠️ קריסה כוללת של הדף
- sample ללא `owner` גרם לשגיאות בתצוגה של תגובות
- לא ניתן היה לגשת לפרטי sample — נגרמה שגיאת JavaScript
- נפתר ע"י הוספת דרישה לשדה `owner` במודל

---

### 📌 תכנון להמשך

#### 🔜 פעולות מתוכננות
- הוספת אימות בצד השרת: כל sample חייב להישמר עם `req.user.id` כ־owner
- הוספת כפתור ברור ליצירת sample חדש דרך UI
- התאמת התצוגה להודעת “אין דגימות זמינות” אם הרשימה ריקה

---

### 📝 סיכום שבועי

יום זה עסק בהתאוששות מתקלת מחיקה חמורה במאגר הדגימות. התבצע תיקון חשוב במודל הנתונים שחייב כל sample לכלול שדה `owner`. בוצעו בדיקות אחרי יצירת דגימות חדשות, והתצוגה חזרה לפעול בצורה תקינה. נלמד לקח חשוב: חיזוק תקינות הנתונים ברמת המודל שומר על יציבות ה־UI.

## 📅 14--16/08/2025 — שבוע חמישי(חלק ): תיקון תצוגת תגובות שלא נטענו, חיזוק הקשר בין sample לתגובות

### ⏱ משך עבודה משוער
כ־9 שעות

---

### ✅ מה הושלם בפועל

#### 💬 תיקון באג בתצוגת תגובות
- תגובות שהיו שמורות ב־sample לא הופיעו בתצוגה בפרונטאנד
- התגלה שהבעיה נבעה ממבנה נתונים שגוי או תגובות שהוזנו לפני תיקון המודל
- בוצע תיקון לכך על ידי בדיקת `sample.comments` וביצוע מיפוי רק כאשר השדה מוגדר ולא ריק

#### 🛠 שיפור התצוגה
- ווידוא שתגובות נטענות בתצוגה רק כאשר הן קיימות בפועל
- שיפור התנאי הלוגי להצגת הודעה “No comments yet” רק כאשר אין תגובות בפועל

---

### 🛠 אתגרים ומה שניסינו לפתור

#### ❌ sample נטען בלי תגובות
- טופל על ידי תיקון שמוודא ש־comments מגיעים מהשרת כחלק מה־sample
- נוספה לוגיקה בטוחה למניעת קריסת רכיב במקרה ש־comments לא קיימים

---

### 📌 תכנון להמשך

#### 🔜 פעולות למחר
- הוספת אפשרות למשתמשים להגיב על sample (טופס תגובה)
- שליחת התגובה לשרת עם טוקן דרך `POST /comments`
- רענון הדף כדי להציג את התגובה החדשה ללא ריענון מלא

---

### 📝 סיכום יומי

היום התמקד בטיפול בבעיה נפוצה שקשורה לרינדור תגובות. הטיפול כלל בניית לוגיקה מבוקרת להצגת התגובות רק כשהן קיימות בפועל. בכך נמנעה קריסה של ממשק המשתמש ונוצר בסיס יציב לבניית מערכת תגובות פעילה ומאובטחת.

## 📅 17-23/08/2025 — שובע שישי :התחלה של מערכת הרשאות, אחסון תפקידים, הכנה למשתמשי admin

### ⏱ משך עבודה משוער
16 שעות

---

### ✅ מה הושלם בפועל

#### 🔐 התחלת מבנה הרשאות לפי תפקידים
- הגדרת שדה `role` במודל המשתמש (user), ערכים אפשריים:
  - `user` (ברירת מחדל)
  - `admin` (לניהול תכנים ומשתמשים)
- שמירה של `role` בטוקן (`auth_token`) שנשלח מהשרת בעת login
- אחסון תפקיד המשתמש גם ב־localStorage בפרונטאנד (`auth_role`)

#### 🧭 שימוש במידע לצורך ניתוב והרשאות
- התחלה של לוגיקה שבודקת את `auth_role` בפרונטאנד:
  - עבור דפים מוגנים או אזורים ניהוליים
- הכנה לאפשרות: להסתיר או להציג אלמנטים לפי תפקיד (כפתורי מחיקה, ניהול משתמשים)

---

### 🛠 אתגרים ומה שניסינו לפתור

#### ⚠️ בלבול בין משתמש רגיל למנהל
- פתרון: הוגדר בתשובה מהשרת בעת login גם ה־role של המשתמש
- שמירה בפורמט JWT וב־localStorage

#### 🔁 התחלה של שימוש ב־auth_token ו־auth_role בפרונטאנד
- קריאת הערכים דרך `localStorage.getItem('auth_token')` ו־`auth_role`
- התחלה של שימוש תנאי בדפים

---

### 📌 תכנון להמשך

#### 🔜 פעולות בהמשך
- להוסיף middleware בצד השרת שיזהה אם משתמש הוא admin
- לאפשר ל־admin למחוק כל sample (לא רק אם הוא ה־owner)
- להציג כפתורי "ניהול משתמשים" רק ל־admin

---

### 📝 סיכום שבוע

ביום זה התחילה התמיכה בתפקידים בפרויקט SampleShare. נוספה תמיכה במבנה הרשאות שבו ניתן להבחין בין משתמש רגיל לבין מנהל (admin). המידע נשמר בטוקן וב־localStorage, ונעשה בו שימוש ראשוני כדי לשלוט בגישה לממשק. בהמשך יתווסף גם middleware בצד השרת שיחזק את השליטה האבטחתית.

## 📅 24--30/08/2025 — שבוע שבעי  : תכנון שיפור UX למחיקה, תיעוד פעולה עתידית

### ⏱ משך עבודה משוער
5 שעות

---

### ✅ מה הושלם בפועל

#### 🧠 תכנון UX לפעולת מחיקה
- זיהוי בעיה בממשק המשתמש:
  - כאשר המשתמש לוחץ על כפתור מחיקה (`Delete`), הוא עדיין פעיל גם בזמן פעולת הקריאה
  - עלול לגרום ללחיצה כפולה, או ניסיון למחוק משהו שכבר נמחק

#### 📝 הוחלט:
- להוסיף בקרוב מצב "Disabled" לכפתור מחיקה בזמן ביצוע הפעולה
- לשנות את הטקסט ל־"Deleting…" בזמן פעולה
- לוודא שהכפתור ננעל, ולא נשלחות בקשות מרובות

#### 🧠 תיעוד תזכורת
- תועד בזיכרון מערכת (context): **להוסיף "Deleting..." מצב נעל בעתיד**
- נשמר גם כהערת TODO ברמת הפרויקט

---

### 🛠 אתגרים ומה שניסינו לפתור

#### 🔁 שיח על התנהגות לא צפויה
- תיעוד עקרוני אך חשוב — למרות שלא נכתבה שורת קוד, מדובר בהחלטה שמשפיעה על UX כללי

---

### 📌 תכנון להמשך

#### 🔜 פעולות לביצוע
- לעטוף את כפתור המחיקה ב־state של React (isDeleting)
- לשנות `disabled` ו־label לפי מצב הבקשה
- להחזיר הודעת הצלחה / שגיאה למשתמש

---

### 📝 סיכום שבועי

השבוע הוקדש לתכנון ושיפור חוויית המשתמש. תועד הצורך לשפר את לחצן המחיקה כך שייתן פידבק ברור למשתמש, ימנע לחיצות כפולות, וישדר אמינות בממשק. השלב עצמו לא כלל קוד, אך היה חיוני כחלק מהבשלת הפרויקט.

## 📅 31/8-6/09/2025 — טיפול בגישה לא מורשית, הכנת הודעת שגיאה למשתמש לא מחובר שבוע שמני 

### ⏱ משך עבודה משוער
כשעה וחצי

---

### ✅ מה הושלם בפועל

#### 🔐 טיפול בגישה ללא טוקן
- התבצעה קריאה לשרת (fetch) למסלול מאובטח (`GET /samples` או `downloadSample`) ללא טוקן
- השרת החזיר שגיאת הרשאה (Unauthorized)
- זוהתה הבעיה: הקריאה לא כללה header מסוג `Authorization`

#### 💬 תכנון הצגת הודעה למשתמש
- תכנון לוגיקה שתציג alert או הודעה ברורה כאשר המשתמש לא מחובר
- הוחלט להוסיף הודעה: **"You must login first"**
- בוצע פיצול לוגי בפרונטאנד:
  - אם אין טוקן → הצגת שגיאה מיידית למשתמש
  - אם יש טוקן → המשך בפעולה כרגיל

---

### 🛠 אתגרים ומה שניסינו לפתור

#### ⚠️ קריסת פעולה או חוסר תגובה
- ללא טוקן, הקריאה פשוט נכשלה – ולא הייתה התראה למשתמש
- הוספת לוגיקה שמגיבה למצב זה עם שגיאה ידידותית

---

### 📌 תכנון להמשך

#### 🔜 פעולות לביצוע
- לעטוף כל קריאת fetch בפרונט עם בדיקה ל־auth_token
- לוודא שהכפתורים לפעולות רגישות לא נגישים ללא טוקן
- להוסיף ניתוב מחדש אוטומטי לעמוד login במידת הצורך

---

### 📝 סיכום שבועי

השבוע זה התמקד בטיפול בשגיאות גישה וניסיון לבצע פעולות ללא התחברות. נוספה לוגיקה שמונעת ממשתמשים לבצע קריאות לשרת אם הם לא מחוברים, ומציגה הודעה ברורה על כך. שיפור זה מכין את הקרקע לחוויית משתמש מאובטחת ומובנית יותר.


## 📅 07--13/09/2025 — טיפול בטוקן שנשלח אך לא התקבל, תיקון fetch ו־Authorization שבוע תישעי

### ⏱ משך עבודה משוער
14 שעות

---

### ✅ מה הושלם בפועל

#### 🧪 בדיקה: שליחת בקשת fetch עם טוקן
- בוצעה קריאה למסלול מוגן (כגון `/samples`, `/download`) עם טוקן שמור
- למרות זאת, השרת החזיר שגיאה כאילו אין הרשאה
- נבדקה בקפידה ה־fetch ונמצא שה־header `Authorization` לא נשלח בפועל

#### 🔧 פתרון:
- עודכן קוד הקריאה:
```ts
fetch(`${API_BASE}/samples`, {
  headers: {
    "Authorization": `Bearer ${token}`
  }
})
```
- ווידוא שהטוקן נשלף מ־localStorage ונשלח כראוי

---

### 🛠 אתגרים ומה שניסינו לפתור

#### ❗ בלבול: טוקן קיים אבל לא פעיל
- המשתמש היה מחובר, הטוקן קיים ב־localStorage, אך לא נשלח בבקשה
- נמצא שהבעיה נובעת מחוסר ב־headers → תוקן

#### 🧪 בדיקה מחודשת:
- הטוקן נשלח כעת
- השרת החזיר את המידע המבוקש בהצלחה ✅

---

### 📌 תכנון להמשך

#### 🔜 פעולות הבאות
- לעטוף כל fetch באובייקט headers עם טוקן
- להוציא פונקציית fetch כללית (`authorizedFetch`) עם הטוקן כברירת מחדל
- לבדוק שמסלול ההורדה (downloadSample) משתמש באותו עיקרון

---

### 📝 סיכום השבוע 

יום זה עסק בטיפול באחת מהטעויות השקטות הנפוצות: טוקן קיים אך לא נשלח בפועל. זוהתה בעיה בגישת fetch לפרונטאנד — ותוקנה על ידי הוספת header Authorization עם טוקן. הבקשות המאובטחות עברו בהצלחה, מה שמאפשר כעת המשך עבודה על מסלולים רגישים יותר.

### ⏱ משך עבודה משוער
6 שעות 

---

### ✅ מה הושלם בפועל

#### 🔐 טיפול בגישה ללא טוקן
- התבצעה קריאה לשרת (fetch) למסלול מאובטח (`GET /samples` או `downloadSample`) ללא טוקן
- השרת החזיר שגיאת הרשאה (Unauthorized)
- זוהתה הבעיה: הקריאה לא כללה header מסוג `Authorization`

#### 💬 תכנון הצגת הודעה למשתמש
- תכנון לוגיקה שתציג alert או הודעה ברורה כאשר המשתמש לא מחובר
- הוחלט להוסיף הודעה: **"You must login first"**
- בוצע פיצול לוגי בפרונטאנד:
  - אם אין טוקן → הצגת שגיאה מיידית למשתמש
  - אם יש טוקן → המשך בפעולה כרגיל

---

### 🛠 אתגרים ומה שניסינו לפתור

#### ⚠️ קריסת פעולה או חוסר תגובה
- ללא טוקן, הקריאה פשוט נכשלה – ולא הייתה התראה למשתמש
- הוספת לוגיקה שמגיבה למצב זה עם שגיאה ידידותית

---

### 📌 תכנון להמשך

#### 🔜 פעולות לביצוע
- לעטוף כל קריאת fetch בפרונט עם בדיקה ל־auth_token
- לוודא שהכפתורים לפעולות רגישות לא נגישים ללא טוקן
- להוסיף ניתוב מחדש אוטומטי לעמוד login במידת הצורך

---

### 📝 סיכום שבועי

השבוע זה התמקד בטיפול בשגיאות גישה וניסיון לבצע פעולות ללא התחברות. נוספה לוגיקה שמונעת ממשתמשים לבצע קריאות לשרת אם הם לא מחוברים, ומציגה הודעה ברורה על כך. שיפור זה מכין את הקרקע לחוויית משתמש מאובטחת ומובנית יותר.


## 📅 14-16/09/2025 — ימים אחרונים  : הגבלת גישת הורדה לפי טוקן, שיפור אבטחת downloadSample

### ⏱ משך עבודה משוער
5שעות 

---

### ✅ מה הושלם בפועל

#### ⬇️ שינוי לוגיקת הורדת sample
- הוגדרה מחדש הפונקציה `downloadSample()` כך שתבצע:
  - בדיקה אם קיים `auth_token` ב־localStorage
  - אם אין טוקן → הצגת alert עם הודעה ברורה למשתמש: `"You must login first"`
  - אם יש טוקן → ביצוע הקריאה עם header Authorization

#### 🧠 שמירה על מבנה הפרויקט הקיים
- לא בוצע שינוי בכללי ב־backend או בקבצים אחרים
- הקפדה לא לגעת בחלקים שלא דרשת — שינוי נקודתי בלבד

#### 🔐 אבטחת קריאות להורדה
- ווידוא שהטוקן נשלח כ־`Bearer` בכותרת הבקשה
- טיפול במקרה שהמשתמש פותח את הדפדפן ללא login קודם

---

### 🛠 אתגרים ומה שניסינו לפתור

#### ❌ ניסיון הורדה ללא הרשאה
- לפני כן, כל אחד היה יכול לשלוח בקשת הורדה לשרת
- לאחר השינוי — בקשה ללא טוקן נחסמת בצד הלקוח
- נוסף alert ברור במקום קריסה שקטה

---

### 📌 תכנון להמשך

#### 🔜 פעולות נוספות:
- להוסיף מסך login אוטומטי אם אין טוקן (ולא רק alert)
- לבדוק בצד השרת ש־download route אכן מאובטח
- לשפר UX בעת ההורדה (מצב טוען, נ鎖 כפתור וכו')

---

### 📝 סיכום 

ביום זה שופרה מערכת ההורדה באתר SampleShare כך שתתאפשר רק למשתמשים מחוברים. הפונקציה `downloadSample` עודכנה לבדוק קיום טוקן, להוסיף את ה־Authorization headers ולחסום בקשות לא מורשות. מדובר בשיפור אבטחה ישיר ונחוץ שמונע הורדה חופשית מקישורים חיצוניים.

## 📅 תאריכים שונים — פעולות שבוצעו אך לא תועדו (השלמות)

### ⏱ משך עבודה משוער
6/7 שעות במצטבר

---

### ✅ מה הושלם בפועל

#### 🗨️ שליחת תגובות חדשות לשרת (`POST /comments`)
- נבנה טופס תגובה לכל sample הכולל:
  - שדה טקסט
  - כפתור “שלח תגובה”
- נשלחת בקשה לשרת עם טוקן ב־Authorization
- בתגובה מוצלחת, התגובה החדשה מוצגת מיידית

#### 💬 עדכון ממשק התגובות בפרונטאנד
- טופס התגובה נבנה תחת התגובות הקיימות
- נוספה בדיקה אם המשתמש מחובר:
  - אם לא — מוצגת הודעה “You must login first” או מוסתר הטופס
- תיבת הטקסט מתנקה לאחר שליחה מוצלחת

#### 🛡️ Middleware בצד שרת לפי תפקיד (admin/user)
- נוספה בדיקת תפקיד בטוקן (JWT) עבור פעולות רגישות
- למשל: רק admin יכול למחוק sample שאינו בבעלותו
- נבנה middleware: `authorizeRole("admin")`

#### 🎛️ טופס הוספת sample חדש בפרונטאנד
- נבנה קומפוננטת טופס עם השדות:
  - title, genre, bpm, url, tags וכו׳
- רק משתמש מחובר יכול לראות את הטופס
- שליחה מתבצעת ל־`POST /samples` עם טוקן

#### ⬇️ כפתור הורדה UI + חיבור ל־downloadSample
- נבנה כפתור הורדה ליד כל sample
- הכפתור נגיש רק אם יש טוקן תקף
- בלחיצה:
  - אם יש טוקן → מתבצעת קריאה ל־downloadSample עם Authorization
  - אם אין טוקן → מוצג alert “You must login first”

---

### 🛠 אתגרים ומה שנפתרו

- שליחה כפולה של תגובות → נמנעה ע”י נעילת כפתור
- בעיות גישה של משתמש רגיל למסלולים admin → נחסמו ע”י middleware
- טוקן לא הועבר בפרונט → תוקן דרך פונקציית fetch כללית

---

### 📝 סיכום כולל

ביום זה תועדו פעולות חשובות שבוצעו בפועל אך לא נכנסו לקובצי ההתקדמות הקודמים. מדובר בבניית מערכת תגובות מלאה, טופס הוספת samples, כפתור הורדה מאובטח, ויישום בקרת הרשאות מלאה לפי תפקידים. כל אלה השלימו את הפיצ'רים הקריטיים של המערכת והציבו אותה כפרויקט שלם, מאובטח, ואינטראקטיבי.
